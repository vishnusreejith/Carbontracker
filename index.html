<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UniCarbon Tracker - Shared Commute Edition</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons for high-quality visuals -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain;
        }

        /* Custom Range Slider Styling */
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #2563eb;
            cursor: pointer;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .range-slider {
            -webkit-appearance: none;
            appearance: none;
            background: #e2e8f0;
            border-radius: 8px;
            height: 8px;
        }

        /* Modal Blur Effect */
        .modal-backdrop {
            backdrop-filter: blur(4px);
            background-color: rgba(15, 23, 42, 0.6);
        }

        /* Button Active States */
        .btn-active-primary {
            background-color: #1e293b !important;
            color: #ffffff !important;
            border-color: #1e293b !important;
        }

        .mode-active {
            border-color: #3b82f6 !important;
            background-color: #eff6ff !important;
            color: #1d4ed8 !important;
        }

        .day-active {
            background-color: #2563eb !important;
            color: #ffffff !important;
            border-color: #2563eb !important;
        }

        /* Animations */
        .animate-in {
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Custom scrollbar for commuter list */
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        /* Prevent zooming on inputs in iOS */
        input[type="text"] {
            font-size: 16px !important;
        }
    </style>
</head>
<body class="text-slate-900">

    <!-- Methodology Modal -->
    <div id="methodologyModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-3 md:p-4 modal-backdrop">
        <div class="bg-white rounded-[2rem] w-full max-w-2xl max-h-[85vh] overflow-y-auto shadow-2xl animate-in">
            <div class="p-5 border-b border-slate-100 flex justify-between items-center sticky top-0 bg-white z-20">
                <h2 class="text-lg md:text-xl font-bold flex items-center gap-2">
                    <i data-lucide="book-open" class="text-blue-500 w-5 h-5 md:w-6 md:h-6"></i>
                    Methodology
                </h2>
                <button onclick="toggleModal(false)" class="p-2 hover:bg-slate-100 rounded-full transition-colors active:scale-90">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="p-5 space-y-6 text-sm leading-relaxed text-slate-600">
                <section>
                    <h3 class="font-bold text-slate-900 text-base mb-2">1. Core Equations</h3>
                    <div class="bg-slate-50 p-4 rounded-2xl space-y-4 border border-slate-100">
                        <div>
                            <p class="font-semibold text-slate-700 mb-1 text-xs">Indiv. Weekly Emissions (Ew):</p>
                            <code class="text-blue-600 font-bold block bg-white p-2 rounded-lg border border-slate-200 overflow-x-auto text-xs">
                                Ew = ((d × 2 × n) × EF × Age_Mult) / Occupants
                            </code>
                        </div>
                    </div>
                </section>

                <section>
                    <h3 class="font-bold text-slate-900 text-base mb-2">2. Factors & Multipliers</h3>
                    <div class="space-y-4">
                        <p class="text-[11px] text-slate-500 italic">Multipliers are based on Bharat Stage (BS) and Euro emission norms.</p>
                        <div class="overflow-x-auto rounded-xl border border-slate-100">
                            <table class="w-full text-left text-[10px] md:text-xs">
                                <thead class="bg-slate-50 text-slate-500 uppercase tracking-wider">
                                    <tr>
                                        <th class="px-3 py-2">Era</th>
                                        <th class="px-3 py-2">BS Norms</th>
                                        <th class="px-3 py-2">Multiplier</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100">
                                    <tr><td class="px-3 py-2 font-bold text-red-500">Vintage</td><td class="px-3 py-2">BS-III / Early IV</td><td class="px-3 py-2 text-center">1.30x</td></tr>
                                    <tr><td class="px-3 py-2 font-bold text-slate-600">Classic</td><td class="px-3 py-2">BS-IV / BS-VI</td><td class="px-3 py-2 text-center">1.00x</td></tr>
                                    <tr><td class="px-3 py-2 font-bold text-emerald-600">Modern</td><td class="px-3 py-2">BS-VI Phase 2</td><td class="px-3 py-2 text-center">0.85x</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
            
            <div class="p-5 bg-slate-50 border-t border-slate-100">
                <button onclick="toggleModal(false)" class="w-full bg-slate-900 text-white font-bold py-3.5 rounded-2xl hover:bg-slate-800 transition-colors active:scale-[0.98]">
                    Got it
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="min-h-screen p-3 md:p-8">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <header class="mb-6 md:mb-8 flex flex-col gap-4">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl md:text-3xl font-extrabold flex items-center gap-2">
                        <i data-lucide="users" class="text-blue-600 w-7 h-7 md:w-8 md:h-8"></i>
                        <span>UniCarbon <span class="text-blue-600">Dept</span></span>
                    </h1>
                    <button onclick="toggleModal(true)" class="p-2.5 bg-white border border-slate-200 rounded-xl shadow-sm text-slate-400 hover:text-blue-500 transition-colors active:scale-90">
                        <i data-lucide="info" class="w-5 h-5"></i>
                    </button>
                </div>
                
                <div class="bg-blue-600 p-4 rounded-2xl shadow-lg shadow-blue-100 flex items-center justify-between text-white">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                            <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <p class="text-[10px] font-bold uppercase tracking-widest leading-none mb-1 opacity-80 text-blue-100">Weekly Dept Total</p>
                            <p class="text-xl font-extrabold" id="deptTotalWeekly">0.00 kg</p>
                        </div>
                    </div>
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-5 md:gap-6">
                <!-- Entry Form -->
                <div class="lg:col-span-5 space-y-5">
                    <div class="bg-white rounded-3xl p-5 md:p-6 shadow-sm border border-slate-100">
                        <h2 class="text-base font-bold mb-5 flex items-center gap-2">
                            <i data-lucide="user-plus" class="text-blue-500 w-4 h-4"></i>
                            New Commuter
                        </h2>
                        
                        <div class="space-y-5">
                            <!-- Commuter Name -->
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 block">Name / Category</label>
                                <input type="text" id="commuterName" placeholder="e.g. Finance Team" class="w-full bg-slate-50 border border-slate-100 rounded-xl px-4 py-3 font-medium focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all placeholder:text-slate-300">
                            </div>

                            <!-- Mode -->
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 block">Mode</label>
                                <div class="grid grid-cols-3 gap-2 md:gap-3">
                                    <button onclick="updateState({vehicleType: 'car'})" id="mode-car" class="py-3 rounded-xl border-2 flex flex-col items-center gap-1.5 text-slate-400 border-slate-100 transition-all active:scale-95">
                                        <i data-lucide="car" class="w-5 h-5"></i>
                                        <span class="text-[9px] font-bold uppercase">Car</span>
                                    </button>
                                    <button onclick="updateState({vehicleType: 'motorcycle'})" id="mode-motorcycle" class="py-3 rounded-xl border-2 flex flex-col items-center gap-1.5 text-slate-400 border-slate-100 transition-all active:scale-95">
                                        <i data-lucide="bike" class="w-5 h-5"></i>
                                        <span class="text-[9px] font-bold uppercase">Bike</span>
                                    </button>
                                    <button onclick="updateState({vehicleType: 'bus'})" id="mode-bus" class="py-3 rounded-xl border-2 flex flex-col items-center gap-1.5 text-slate-400 border-slate-100 transition-all active:scale-95">
                                        <i data-lucide="bus" class="w-5 h-5"></i>
                                        <span class="text-[9px] font-bold uppercase">Bus</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Options -->
                            <div id="configOptions" class="space-y-5 bg-slate-50 p-4 rounded-2xl border border-slate-100">
                                <div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 block">Engine</label>
                                    <div class="flex flex-wrap gap-2" id="fuelSelector"></div>
                                </div>
                                <div id="sizeSection">
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 block">Size</label>
                                    <div class="flex flex-wrap gap-2" id="sizeSelector"></div>
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 block">BS Norm / Age</label>
                                    <div class="grid grid-cols-3 gap-1.5" id="ageSelector"></div>
                                </div>
                                <div id="occupancySection">
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Occupancy</label>
                                        <span class="text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded text-[10px] font-extrabold" id="occupancyLabel">1 person</span>
                                    </div>
                                    <input type="range" id="occupancyInput" min="1" max="5" value="1" class="range-slider w-full cursor-pointer" oninput="updateState({occupancy: parseInt(this.value)})">
                                </div>
                            </div>

                            <!-- Journey -->
                            <div class="space-y-5">
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Distance (1-Way)</label>
                                        <span class="text-blue-600 font-bold text-xs" id="distanceLabel">10 km</span>
                                    </div>
                                    <input type="range" min="1" max="100" value="10" class="range-slider w-full cursor-pointer" oninput="updateState({distance: parseInt(this.value)})">
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-3 block">Days / Week</label>
                                    <div class="flex justify-between gap-1" id="daySelector"></div>
                                </div>
                            </div>

                            <button onclick="addCommuter()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-extrabold py-4 rounded-2xl transition-all shadow-lg shadow-blue-100 flex items-center justify-center gap-2 active:scale-[0.97]">
                                <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                Add Entry
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stats & List -->
                <div class="lg:col-span-7 space-y-5">
                    <!-- Summary Stats -->
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 md:gap-4">
                        <div class="bg-white p-4 md:p-6 rounded-[1.5rem] shadow-sm border border-slate-100 flex flex-col justify-center items-center text-center">
                            <p class="text-[9px] font-bold text-slate-400 uppercase mb-1">Users</p>
                            <p class="text-xl font-black text-slate-800" id="statCommuters">0</p>
                        </div>
                        <div class="bg-white p-4 md:p-6 rounded-[1.5rem] shadow-sm border border-slate-100 flex flex-col justify-center items-center text-center">
                            <p class="text-[9px] font-bold text-slate-400 uppercase mb-1">Yearly CO₂</p>
                            <p class="text-xl font-black text-slate-800" id="statYearly">0 kg</p>
                        </div>
                        <div class="bg-emerald-50 p-4 md:p-6 rounded-[1.5rem] border border-emerald-100 flex flex-col justify-center items-center text-center col-span-2 sm:col-span-1">
                            <p class="text-[9px] font-bold text-emerald-600 uppercase mb-1">Tree Offset</p>
                            <p class="text-xl font-black text-emerald-700" id="statTrees">0</p>
                        </div>
                    </div>

                    <!-- Commuter List -->
                    <div class="bg-white rounded-3xl shadow-sm border border-slate-100 flex flex-col h-[400px] md:h-[650px] overflow-hidden">
                        <div class="p-4 md:p-6 border-b border-slate-50 flex justify-between items-center">
                            <h2 class="text-base font-bold flex items-center gap-2">
                                <i data-lucide="list" class="text-slate-400 w-4 h-4"></i>
                                Records
                            </h2>
                            <button onclick="clearList()" class="text-[10px] font-extrabold text-red-400 hover:text-red-500 transition-colors uppercase tracking-widest active:scale-95">Clear</button>
                        </div>
                        <div id="commuterList" class="flex-grow overflow-y-auto p-4 md:p-6 space-y-3 custom-scroll bg-slate-50/30">
                            <div class="h-full flex flex-col items-center justify-center text-slate-300 space-y-3 opacity-60">
                                <i data-lucide="inbox" class="w-10 h-10"></i>
                                <p class="text-xs font-bold uppercase tracking-widest">List Empty</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="mt-8 md:mt-12 text-center text-slate-400 text-[10px] font-bold uppercase tracking-widest pb-8">
                <p>UniCarbon Analytics • 2026 Campus Office</p>
            </footer>
        </div>
    </div>

    <script>
        // Constants
        const EMISSION_FACTORS = {
            car: {
                gasoline: { compact: 0.15, sedan: 0.19, suv: 0.25, truck: 0.32 },
                diesel: { compact: 0.14, sedan: 0.18, suv: 0.24, truck: 0.30 },
                hybrid: { compact: 0.08, sedan: 0.10, suv: 0.13 },
                electric: { all: 0.05 }
            },
            motorcycle: {
                gasoline: { all: 0.08 },
                electric: { all: 0.02 }
            },
            bus: {
                diesel: { all: 0.04 },
                hybrid: { all: 0.025 },
                electric: { all: 0.015 }
            }
        };

        const AGE_MULTIPLIERS = {
            vintage: 1.30, // BS-III or older
            classic: 1.00, // BS-IV / early BS-VI
            modern: 0.85   // BS-VI Phase 2
        };

        // App State
        let state = {
            vehicleType: 'car',
            fuelType: 'gasoline',
            size: 'sedan',
            age: 'classic',
            distance: 10,
            days: 5,
            occupancy: 1
        };

        let departmentCommuters = [];

        // UI Initialization
        function init() {
            lucide.createIcons();
            updateUI();
        }

        function toggleModal(show) {
            const modal = document.getElementById('methodologyModal');
            modal.classList.toggle('hidden', !show);
            document.body.style.overflow = show ? 'hidden' : 'auto';
        }

        function updateState(newState) {
            state = { ...state, ...newState };
            
            // Safety: reset fuelType if it doesn't exist for new mode
            if (!EMISSION_FACTORS[state.vehicleType][state.fuelType]) {
                state.fuelType = Object.keys(EMISSION_FACTORS[state.vehicleType])[0];
            }
            
            updateUI();
        }

        function addCommuter() {
            const nameInput = document.getElementById('commuterName');
            const name = nameInput.value.trim() || `User #${departmentCommuters.length + 1}`;
            
            const modeData = EMISSION_FACTORS[state.vehicleType];
            const fuelData = modeData[state.fuelType];
            const factor = fuelData[state.size] || fuelData.all;

            const ageMult = AGE_MULTIPLIERS[state.age];
            const divisor = (state.vehicleType === 'bus') ? 1 : state.occupancy;
            
            const weekly = (state.distance * 2 * state.days * factor * ageMult) / divisor;

            departmentCommuters.push({
                id: Date.now(),
                name: name,
                weekly: weekly,
                details: `${state.age.toUpperCase()} ${state.fuelType} ${state.vehicleType} (${divisor}p)`,
                dist: state.distance,
                days: state.days
            });

            nameInput.value = '';
            renderCommuterList();
            updateDeptStats();
            
            if (departmentCommuters.length === 1 && window.innerWidth < 1024) {
                document.getElementById('commuterList').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function clearList() {
            departmentCommuters = [];
            renderCommuterList();
            updateDeptStats();
        }

        function removeCommuter(id) {
            departmentCommuters = departmentCommuters.filter(c => c.id !== id);
            renderCommuterList();
            updateDeptStats();
        }

        function renderCommuterList() {
            const list = document.getElementById('commuterList');
            if (departmentCommuters.length === 0) {
                list.innerHTML = `
                    <div class="h-full flex flex-col items-center justify-center text-slate-300 space-y-3 opacity-60">
                        <i data-lucide="inbox" class="w-10 h-10"></i>
                        <p class="text-xs font-bold uppercase tracking-widest">List Empty</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            list.innerHTML = departmentCommuters.slice().reverse().map(c => `
                <div class="bg-white border border-slate-100 rounded-2xl p-3 md:p-4 flex justify-between items-center animate-in shadow-sm">
                    <div class="flex-grow pr-2">
                        <p class="font-bold text-slate-800 text-sm md:text-base truncate max-w-[140px] md:max-w-none">${c.name}</p>
                        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-wider capitalize truncate">${c.details} • ${c.dist}km • ${c.days}d</p>
                    </div>
                    <div class="flex items-center gap-3 md:gap-4 shrink-0">
                        <div class="text-right">
                            <p class="font-black text-slate-700 leading-none text-sm md:text-base">${c.weekly.toFixed(1)}</p>
                            <p class="text-[8px] font-bold text-slate-400 uppercase">kg/wk</p>
                        </div>
                        <button onclick="removeCommuter(${c.id})" class="p-2 text-slate-200 hover:text-red-400 transition-colors active:scale-90">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function updateDeptStats() {
            const totalWeekly = departmentCommuters.reduce((sum, c) => sum + c.weekly, 0);
            const totalYearly = totalWeekly * 52;
            const totalTrees = Math.ceil(totalYearly / 20);

            document.getElementById('deptTotalWeekly').innerText = `${totalWeekly.toFixed(2)} kg`;
            document.getElementById('statCommuters').innerText = departmentCommuters.length;
            document.getElementById('statYearly').innerText = `${totalYearly.toFixed(0)} kg`;
            document.getElementById('statTrees').innerText = totalTrees;
        }

        function updateUI() {
            const sizeSect = document.getElementById('sizeSection');
            const occupancySect = document.getElementById('occupancySection');
            
            sizeSect.style.display = (state.vehicleType === 'car' && state.fuelType !== 'electric') ? 'block' : 'none';
            occupancySect.style.display = (state.vehicleType !== 'bus') ? 'block' : 'none';
            
            document.getElementById('occupancyLabel').innerText = `${state.occupancy} ${state.occupancy === 1 ? 'person' : 'people'}`;
            document.getElementById('distanceLabel').innerText = `${state.distance} km`;

            renderModeButtons();
            renderFuelButtons();
            renderSizeButtons();
            renderAgeButtons();
            renderDayButtons();
        }

        function renderModeButtons() {
            ['car', 'motorcycle', 'bus'].forEach(m => {
                const btn = document.getElementById(`mode-${m}`);
                btn.className = `py-3 rounded-xl border-2 flex flex-col items-center gap-1.5 transition-all active:scale-95 ${
                    state.vehicleType === m ? 'mode-active' : 'text-slate-400 border-slate-100'
                }`;
            });
        }

        function renderFuelButtons() {
            const cont = document.getElementById('fuelSelector');
            const fuels = Object.keys(EMISSION_FACTORS[state.vehicleType]);
            cont.innerHTML = fuels.map(f => `
                <button onclick="updateState({fuelType: '${f}'})" 
                        class="px-2.5 py-1.5 rounded-lg text-[9px] font-bold border transition-all active:scale-95 ${state.fuelType === f ? 'btn-active-primary' : 'bg-white text-slate-500 border-slate-200'}">
                    ${f.charAt(0).toUpperCase() + f.slice(1)}
                </button>
            `).join('');
        }

        function renderSizeButtons() {
            const cont = document.getElementById('sizeSelector');
            const sizes = ['compact', 'sedan', 'suv', 'truck'];
            cont.innerHTML = sizes.map(s => `
                <button onclick="updateState({size: '${s}'})" 
                        class="px-2.5 py-1.5 rounded-lg text-[9px] font-bold border transition-all active:scale-95 ${state.size === s ? 'btn-active-primary' : 'bg-white text-slate-500 border-slate-200'}">
                    ${s.charAt(0).toUpperCase() + s.slice(1)}
                </button>
            `).join('');
        }

        function renderAgeButtons() {
            const cont = document.getElementById('ageSelector');
            const ages = ['vintage', 'classic', 'modern'];
            cont.innerHTML = ages.map(a => `
                <button onclick="updateState({age: '${a}'})" 
                        class="px-1.5 py-2 rounded-lg text-[8px] font-bold border transition-all active:scale-95 text-center ${state.age === a ? 'btn-active-primary' : 'bg-white text-slate-500 border-slate-200'}">
                    ${a === 'vintage' ? 'BS-III' : a === 'classic' ? 'BS-IV/VI' : 'BS-VI.2'}
                </button>
            `).join('');
        }

        function renderDayButtons() {
            const cont = document.getElementById('daySelector');
            cont.innerHTML = [1, 2, 3, 4, 5, 6, 7].map(d => `
                <button onclick="updateState({days: ${d}})" 
                        class="flex-1 py-2 text-[10px] font-black rounded-lg border-2 transition-all active:scale-95 ${state.days === d ? 'day-active' : 'bg-white text-slate-400 border-slate-100'}">
                    ${d}
                </button>
            `).join('');
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
